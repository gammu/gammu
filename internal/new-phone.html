<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding support for new phone &mdash; Gammu 1.42.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File formats used by Gammu" href="../formats/index.html" />
    <link rel="prev" title="State Machine" href="state-machine.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Gammu
          </a>
              <div class="version">
                1.42.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../project/index.html">Gammu project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick/index.html">Quick starter guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">python-gammu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c/index.html">libGammu</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Gammu internals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="reply.html">Reply functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="state-machine.html">State Machine</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding support for new phone</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-support-for-new-at-commands">Adding support for new AT commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#detecting-whether-command-is-supported">Detecting whether command is supported</a></li>
<li class="toctree-l4"><a class="reference internal" href="#invoking-at-command">Invoking AT command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parsing-reply">Parsing reply</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../formats/index.html">File formats used by Gammu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">Gammu Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gammu/index.html">Gammu Utility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../smsd/index.html">SMS Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">Miscellaneous utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing Gammu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocol/index.html">Phone Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Gammu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Gammu internals</a></li>
      <li class="breadcrumb-item active">Adding support for new phone</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/internal/new-phone.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-support-for-new-phone">
<h1>Adding support for new phone<a class="headerlink" href="#adding-support-for-new-phone" title="Permalink to this heading"></a></h1>
<p>This document covers basic information on adding support for new phone into
Gammu. It will never cover all details, but will give you basic instructions.</p>
<section id="adding-support-for-new-at-commands">
<h2>Adding support for new AT commands<a class="headerlink" href="#adding-support-for-new-at-commands" title="Permalink to this heading"></a></h2>
<p>The easiest situation is when all you need to support new device is to add
support for new AT commands. All the protocol infrastructure is there, you
only need to hook new code into right places.</p>
<p>The main code for AT driver is in <code class="file docutils literal notranslate"><span class="pre">libgammu/phone/at/atgen.c</span></code>. At the
bottom of the file, you can find two arrays, one defining driver interface
(<code class="xref c c-type docutils literal notranslate"><span class="pre">GSM_Phone_Functions</span></code>) and second one defining callbacks (see
<a class="reference internal" href="reply.html#reply-functions"><span class="std std-ref">Reply functions</span></a> for more detailed description. You will definitely need
to define callbacks for newly introduced commands, but the interface for
desired functionality might already exist.</p>
<section id="detecting-whether-command-is-supported">
<h3>Detecting whether command is supported<a class="headerlink" href="#detecting-whether-command-is-supported" title="Permalink to this heading"></a></h3>
<p>As Gammu is trying to support as much phones as possible, you should try to
make it automatically detect whether connected phone supports the command.
This can be done on first invocation of affected operation or on connecting to
phone. As we want to avoid lengthy connecting to phone, in most cases you
should probe for support on first attempt to use given functionality. The code
might look like following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">GSM_Error</span><span class="w"> </span><span class="nf">ATGEN_GetFoo</span><span class="p">(</span><span class="n">GSM_StateMachine</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GSM_Phone_ATGENData</span><span class="w">     </span><span class="o">*</span><span class="n">Priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Phone</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Priv</span><span class="p">.</span><span class="n">ATGEN</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Priv</span><span class="o">-&gt;</span><span class="n">Foo_XXXX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ATGEN_CheckXXXX</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Priv</span><span class="o">-&gt;</span><span class="n">Foo_XXXX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AT_AVAILABLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Perform reading */</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* Fail with error or fallback to other methods */</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ERR_NOTSUPPORTED</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">GSM_Error</span><span class="w"> </span><span class="nf">ATGEN_CheckXXXX</span><span class="p">(</span><span class="n">GSM_StateMachine</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GSM_Error</span><span class="w">       </span><span class="n">error</span><span class="p">;</span>
<span class="w">    </span><span class="n">GSM_Phone_ATGENData</span><span class="w">     </span><span class="o">*</span><span class="n">Priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Phone</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Priv</span><span class="p">.</span><span class="n">ATGEN</span><span class="p">;</span>

<span class="w">    </span><span class="n">smprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Checking availability of XXXX</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ATGEN_WaitForAutoLen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AT+XXXX=?</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">ID_GetProtocol</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ERR_NONE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Priv</span><span class="o">-&gt;</span><span class="n">Foo_XXXX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AT_AVAILABLE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Priv</span><span class="o">-&gt;</span><span class="n">Foo_XXXX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AT_NOTAVAILABLE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">GSM_Reply_Function</span><span class="w"> </span><span class="n">ATGENReplyFunctions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="p">...</span>
<span class="p">{</span><span class="n">ATGEN_GenericReply</span><span class="p">,</span><span class="w">        </span><span class="s">&quot;AT+XXXX=?&quot;</span><span class="w">             </span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">ID_GetProtocol</span><span class="w">                </span><span class="p">},</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Alternatively (if detection is not possible), you can use features and phones
database (see <code class="file docutils literal notranslate"><span class="pre">libgammu/gsmphones.c</span></code>) or vendor based decision to use
some commands.</p>
</section>
<section id="invoking-at-command">
<h3>Invoking AT command<a class="headerlink" href="#invoking-at-command" title="Permalink to this heading"></a></h3>
<p>The AT commands are invoked using <code class="xref c c-func docutils literal notranslate"><span class="pre">GSM_WaitFor()</span></code>, or a wrapper
<code class="xref c c-func docutils literal notranslate"><span class="pre">ATGEN_WaitForAutoLen()</span></code>, where you don’t have to specify length for
text commands and automatically sets error variable.</p>
<p>Generally you need to construct buffer and then invoke it. For some simple
functions it is pretty straight forward:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">GSM_Error</span><span class="w"> </span><span class="nf">ATGEN_GetBatteryCharge</span><span class="p">(</span><span class="n">GSM_StateMachine</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">GSM_BatteryCharge</span><span class="w"> </span><span class="o">*</span><span class="n">bat</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GSM_Error</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>

<span class="w">    </span><span class="n">GSM_ClearBatteryCharge</span><span class="p">(</span><span class="n">bat</span><span class="p">);</span>
<span class="w">    </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Phone</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">BatteryCharge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bat</span><span class="p">;</span>
<span class="w">    </span><span class="n">smprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Getting battery charge</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ATGEN_WaitForAutoLen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AT+CBC</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">ID_GetBatteryCharge</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see, it is often required to store pointer to data store somewhere,
for most data types <code class="docutils literal notranslate"><span class="pre">s-&gt;Phone.Data</span></code> does contain the pointer to do that.</p>
</section>
<section id="parsing-reply">
<h3>Parsing reply<a class="headerlink" href="#parsing-reply" title="Permalink to this heading"></a></h3>
<p>For parsing reply, you should use <code class="xref c c-func docutils literal notranslate"><span class="pre">ATGEN_ParseReply()</span></code>, which should
be able to handle all encoding and parsing magic. You can grab lines from the
reply using <code class="xref c c-func docutils literal notranslate"><span class="pre">GetLineString()</span></code>.</p>
<p>The reply function needs to be hooked to the reply functions array, so that it
is invoked when reply is received from the phone.</p>
<p>Continuing in above example for getting battery status, the (simplified)
function would look like:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">GSM_Error</span><span class="w"> </span><span class="nf">ATGEN_ReplyGetBatteryCharge</span><span class="p">(</span><span class="n">GSM_Protocol_Message</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">GSM_StateMachine</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GSM_Error</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="w">    </span><span class="n">GSM_Phone_ATGENData</span><span class="w"> </span><span class="o">*</span><span class="n">Priv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Phone</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Priv</span><span class="p">.</span><span class="n">ATGEN</span><span class="p">;</span>
<span class="w">    </span><span class="n">GSM_BatteryCharge</span><span class="w"> </span><span class="o">*</span><span class="n">BatteryCharge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Phone</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">BatteryCharge</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">bcl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">Phone</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Priv</span><span class="p">.</span><span class="n">ATGEN</span><span class="p">.</span><span class="n">ReplyState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">AT_Reply_OK</span><span class="p">:</span>
<span class="w">            </span><span class="n">smprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Battery level received</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ATGEN_ParseReply</span><span class="p">(</span><span class="n">s</span><span class="p">,</span>
<span class="w">                </span><span class="n">GetLineString</span><span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">Buffer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Priv</span><span class="o">-&gt;</span><span class="n">Lines</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="w">                </span><span class="s">&quot;+CBC: @i, @i&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="o">&amp;</span><span class="n">bcs</span><span class="p">,</span>
<span class="w">                </span><span class="o">&amp;</span><span class="n">bcl</span><span class="p">);</span>

<span class="w">            </span><span class="n">BatteryCharge</span><span class="o">-&gt;</span><span class="n">BatteryPercent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bcl</span><span class="p">;</span>

<span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">bcs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">                    </span><span class="n">BatteryCharge</span><span class="o">-&gt;</span><span class="n">ChargeState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GSM_BatteryPowered</span><span class="p">;</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">                    </span><span class="n">BatteryCharge</span><span class="o">-&gt;</span><span class="n">ChargeState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GSM_BatteryConnected</span><span class="p">;</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">                    </span><span class="n">BatteryCharge</span><span class="o">-&gt;</span><span class="n">ChargeState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GSM_BatteryCharging</span><span class="p">;</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="k">default</span><span class="o">:</span>
<span class="w">                    </span><span class="n">BatteryCharge</span><span class="o">-&gt;</span><span class="n">ChargeState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">                    </span><span class="n">smprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WARNING: Unknown battery state: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bcs</span><span class="p">);</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ERR_NONE</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">AT_Reply_Error</span><span class="p">:</span>
<span class="w">            </span><span class="n">smprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Can&#39;t get battery level</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ERR_NOTSUPPORTED</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">AT_Reply_CMSError</span><span class="p">:</span>
<span class="w">            </span><span class="n">smprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Can&#39;t get battery level</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ATGEN_HandleCMSError</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">AT_Reply_CMEError</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ATGEN_HandleCMEError</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ERR_UNKNOWNRESPONSE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="n">GSM_Reply_Function</span><span class="w"> </span><span class="n">ATGENReplyFunctions</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="p">...</span>
<span class="p">{</span><span class="n">ATGEN_ReplyGetBatteryCharge</span><span class="p">,</span><span class="w">       </span><span class="s">&quot;AT+CBC&quot;</span><span class="w">                </span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">ID_GetBatteryCharge</span><span class="w">   </span><span class="p">},</span>
<span class="p">...</span>
</pre></div>
</div>
<p>As you can see, all reply function first need to handle which error code did
they receive and return appropriate error if needed. Functions
<code class="xref c c-func docutils literal notranslate"><span class="pre">ATGEN_HandleCMSError()</span></code> and <code class="xref c c-func docutils literal notranslate"><span class="pre">ATGEN_HandleCMEError()</span></code> simplify
this, but you might need to customize it by handling some error codes manually
(eg. when phone returns error on empty location).</p>
<p>The rest of the function is just call to <code class="xref c c-func docutils literal notranslate"><span class="pre">ATGEN_ParseReply()</span></code> and
processing parsed data.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="state-machine.html" class="btn btn-neutral float-left" title="State Machine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../formats/index.html" class="btn btn-neutral float-right" title="File formats used by Gammu" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2015, Michal Čihař &lt;michal@cihar.com&gt;.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>